<!DOCTYPE html>
<html>

  <head>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: {
        equationNumbers: { autoNumber: "AMS" },
        tagSide: "right"
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      }
    });
    MathJax.Hub.Register.StartupHook("TeX AMSmath Ready", function () {
      MathJax.InputJax.TeX.Stack.Item.AMSarray.Augment({
        clearTag() {
          if (!this.global.notags) {
            this.super(arguments).clearTag.call(this);
          }
        }
      });
    });
  </script>
  <script type="text/javascript" charset="utf-8"
    src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS_CHTML">
  </script>


  <!-- <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Geometric patterns in croplands</title>
  <meta name="description" content="I’ve lived in California for five years now and have had the good fortune to roam up and down the state and see its mountains, valleys, and deserts.As any ou...">

  <!-- <link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
  <script src="/boostrap/js/bootstrap.js"></script> -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">

  <link rel="canonical" href="http://localhost:4000/blog/cropland-crystallography/">
  <link rel="alternate" type="application/rss+xml" title="JS" href="http://localhost:4000/feed.xml">

  

</head>


  <body>

    <!-- <header class="site-header"> -->
    <!-- <a class="site-title" href="/">JS</a> -->
<!-- </header> -->

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #edf3f5;">
      <div class = "container">
        <a class="navbar-brand" href="/">JS</a></span> </a>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav ml-auto">
            <li class = "nav-item active"><a class="nav-link" href="/#research"><i class="fas fa-cogs"></i> Research</a></li>
            <li class = "nav-item active"><a class="nav-link" href="/#puzzles"><i class="fab fa-laravel"></i> Puzzles</a></li>
            <li class = "nav-item active"><a class="nav-link" href="/#posts"><i class="fas fa-seedling"></i> Blog</a></li>
          </ul> 
        </div>
      </div>
    </nav>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <div class="container">
    <br>

    <header class="post-header">
      <h1 class="post-title" itemprop="name headline">Geometric patterns in croplands</h1>
      <p class="post-meta"><time datetime="2024-04-21T00:00:00-04:00" itemprop="datePublished">Apr 21, 2024</time></p>
    </header>

    <div class="post-content" itemprop="articleBody">
      <p>I’ve lived in California for five years now and have had the good fortune to roam up and down the state and see its mountains, valleys, and deserts.
As any outdoorsy Californian will know, these treks often featured long drives through the Central Valley, past wide fields of California crops: fruits, nuts, grain.
As a frequent passenger in these drives, I’ve come to look forward to gazing out a changing windowful of cropland, particularly when it makes a certain sort of geometric pattern.</p>

<p style="text-align:center;">
	<a href="https://www.google.com/maps/@35.8815158,-119.858065,3a,75y,51.88h,81.48t/data=!3m6!1e1!3m4!1sXlBlznQpA42OVCiQcwKAEg!2e0!7i16384!8i8192?entry=ttu">
		<img src="/img/croprows/croprow_pic_2.jpg" width="100%" />
	</a>
</p>

<p>If you’re not familiar with this effect, take a minute to really examine the strip of field planted with the baby trees.
As you scan across the strip, you’ll notice places where the saplings form lines leading off into the distance.
The lines have different degrees of definition, and the gaps between the lines have different sizes in different places.
The “regions” of lines seem to have a curious fractal pattern: if you look between two neighboring line-regions, you’ll find another, smaller set of more closely spaced lines, and so on recursively.
I find it mysterious and beautiful.
For fun, you can click on the above image to be taken to the corresponding spot in Google Streetview if you want to explore it for yourself.</p>

<p style="text-align:center;">
	<img src="/img/croprows/cropland_with_regions.jpg" width="100%" />
</p>

<p>The regions pop out to the eye even more when you’re moving! Here’s a gif of the view out my window as I drove by the same place.</p>

<p style="text-align:center;">
	<img src="/img/croprows/croprow_gif.gif" width="100%" />
</p>

<p>What’s going on? In this post, I’ll explain why we see these “open” directions and try to explain why the overall visual effect is so fractally.
The basic explanation of the open regions will need only some simple math used in the physics of crystals.
When we try to understand the fractally effect, we’ll encounter some cool number theory.
I’ll end with a neat numerical experiment and an open question.</p>

<p><br /></p>

<h2 id="the-open-directions-of-an-infinite-lattice">The open directions of an infinite lattice</h2>

<p>The nature of the special directions is easily understood starting from the observation that these saplings are planted in a near-perfect rectangular grid.<sup id="fnref:f" role="doc-noteref"><a href="#fn:f" class="footnote">1</a></sup>
In such a grid, one expects the plants to leave “aisles” along the grid directions, and if one plays around with a drawing of a grid, one soon observes that the points also form narrower isles in other, off-axis directions.
See the colored “aisles” in the illustration below.</p>

<p style="text-align:center;">
	<img src="/img/croprows/grid_gap_illustration.png" width="70%" />
</p>

<p>The three examples in the above illustration correspond to particular “lattice vector” – that is, vectors \((a, b)\) with integer components, with \(a, b\) “irreducible” – that is, sharing no factors greater than \(1\).<sup id="fnref:q" role="doc-noteref"><a href="#fn:q" class="footnote">2</a></sup>
It turns out that all “open directions” – that is, directions one can look without hitting (or passing arbitrarily close to) a tree – correspond to such lattice vector!</p>

<p>The above illustration highlights the gaps between the rows of trees, but we might similarly talk about the rows of trees lying <em>between</em> the colored rectangles.
This is the perspective taken in crystallography.
The atoms in a crystal form a regular lattice by definition, and this lattice can be decomposed into many parallel rows (or <em>sheets</em> in 3D), and light of the appropriate frequency will scatter off these surfaces as if they were partially reflective mirrors.
This is a common experimental technique for <a href="https://en.wikipedia.org/wiki/X-ray_crystallography">identifying different crystals</a>.</p>

<p><br /></p>

<h2 id="which-open-directions-will-you-see">Which open directions will you see?</h2>

<p>Great – we now have a rule describing our open directions: every direction in which one can gaze unblocked off to infinity is parallel to a lattice vector \((a, b)\), where \(a, b\) are an irreducible pair of integers.
When we look out at a big field, we should thus see a total number of… *<em>furiously counting on fingers</em>* <strong>infinitely many</strong> open directions, one for every \((a, b)\).
Well, that doesn’t seem right, looking at our photograph above – what’s gone wrong?</p>

<p>Three things.
First, the field in the photo above is finite, and there are some directions we don’t see that would emerge if the field were extended.
Second, our camera has finite resolution.
Third, the trees have <em>nonzero width</em> – some lattice directions give wider “aisles” than others, and if an aisle’s narrower than the size of a tree, we won’t see it even provided an infinite field and perfect camera.<sup id="fnref:a" role="doc-noteref"><a href="#fn:a" class="footnote">3</a></sup></p>

<p>All three of these effects point to a general conclusion: <strong>wider “aisles” are more visually salient.</strong>
It’d thus be useful to know the “aisle width” (or equivalent the “lattice row spacing”) corresponding to a particular lattice direction.
Some quick geometry tells us that, with pointlike trees on a unit lattice, the aisle width in direction \((a, b)\) is \(w_{a,b} = \frac{1}{\sqrt{a^2 + b^2}}.\)
This gives us a satisfying ordering of lattice directions: a lattice direction \((a, b)\) is more visually salient the smaller \(\sqrt{a^2 + b^2}\) is – that is, the closer it is to the origin!
We should thus expect the directions \((0, \pm 1)\) and \((\pm 1, 0)\) to appear most visually striking, followed by \((\pm 1, \pm 1)\), then \((\pm 1, \pm 2)\) and \((\pm 2, \pm 1)\), and so on and so forth.</p>

<p>I’ve annotated our original image with the actual lattice directions.
This is precisely what we see:</p>

<p style="text-align:center;">
	<img src="/img/croprows/cropland_with_regions_labeled.jpg" width="100%" />
</p>

<p>Note that the different lattice directions look like they’re parallel in this image, but they actually point radially outwards from the camera at different angles.
If we had an infinite field and a camera of good enough precision, we’d expect to see open directions corresponding to all irreducible \((a, b)\) such that \(w_{a, b}\) is less than the width of one sapling.</p>

<p><br /></p>

<h2 id="fancy-math-farey-sequences-and-recursive-structure">Fancy math: Farey sequences and recursive structure</h2>

<p>The math so far is pretty familiar to physicists – we’re used to thinking about lattices and lattice vectors, having seen them a hundred times in quantum courses.
As I’ve looked out at scenes like this, the thing I really wanted to understand is: <em>why does it look so fractal?</em></p>

<p>Let me try to be more precise: the little triangles of open “aisles” in our field photograph sure give the impression of a sort of recursive structure – given two big triangles, one usually finds a medium triangle between them, and there are never two big triangles too close to each other, sort of like a compass rose:</p>

<p style="text-align:center;">
	<img src="/img/croprows/compass_rose.jpeg" width="20%" />
</p>

<p>It very much looks to me like, if you started adding triangular regions in order of decreasing size, you’d tend to insert each new triangle closer than chance to the midpoint of its neighbors.
I actually simulated this and it’s not true – to my surprise the distribution appears to be uniform – but in my trying to understand this I did come across some cool math.</p>

<p><a href="https://en.wikipedia.org/wiki/Farey_sequence">Farey sequences</a> are sequences of rational fractions defined in the following manner:
the Farey sequence of order \(n\) consists of all unique rational numbers in \([0,1]\) with denominator less than or equal to \(n\).
This actually maps nicely onto our problem restricted such that \(b \ge a \ge 0\), in which case the valid \(\frac{a}{b}\) are exactly the rational numbers in \([0, 1]\).
The Farey sequences have many weird properties, one of which is the following: if \(\frac{a}{b}\) and \(\frac{c}{d}\) are neighbors in a Farey sequence, then as you increase \(n\), the first element to appear between them is always \(\frac{a + c}{b + d}\).
In our problem, that means that if there are open directions at \((a, b)\) and \((c, d)\) and no bigger open direction between them, then the <em>biggest</em> open direction between them will lie at \((a + c, b + d)\)!
For example, the biggest open direction between \((0,1)\) and \((1,0)\) is \((1,1)\), and the biggest open direction between Farey-neighbors \((3,5)\) and \((2,3)\) is \((5, 8)\).
The wiki page for the Farey sequences has all sorts of interesting recursive diagrams that fall out of this recursive structure.
(Sidebar: as of writing, I don’t understand why this property is true. I’d be happy to have someone explain it to me!)</p>

<p>What does this tell us about the visual effect one sees when looking out at a regularly-planted field?
Well, it means that, when adding the next-biggest open region between two existing regions, it’ll tend to be placed closer to the <em>smaller</em> of the two existing regions.
Looking back at our field photograph (esp the version annotated with arrows), this is certainly the case!</p>

<p><br /></p>

<h2 id="can-apparent-openness-vs-angle-be-described-by-a-smooth-function">Can “apparent openness” vs. angle be described by a smooth function?</h2>

<p>Number theory is very beautiful, but essentially discrete in nature.
The special directions we find are pointlike: look in one <em>particular direction</em> and you’ll see forever, but a little bit to either side and you won’t.
However, when I look out at a cropfield like this – particularly at the gif – my eye isn’t just drawn to certain points: a bigger region leading up to the point at infinity pops out to me visually.
This makes sense – in the idealized setting, if I look slightly off an infinite-sight direction, I’ll still see pretty far!
This makes me want some kind of <em>continuous</em> function of angle that tells me, say, how far I’ll typically see when looking in that direction.
Perhaps this function is parameterized by some notion of tree diameter \(d\), and has peaks that appear at the rational angles as \(d\) decreases.</p>

<p>I’ll say upfront that I tried for a while and didn’t come up with anything nice.
This is the open question: can one write down a nice analytical function of angle that in some sense captures “how far” one can see along angle \(\theta\) through a forest of regularly-spaced trees of diameter \(d\)?</p>

<p>What I do have is a hacky numerical experiment and some cool plots.
I’ll use a proxy metric I can compute in Python: with trees of diameter \(d\), what’s the farthest one could possibly see in direction \(\theta\) if one stood in the optimal place?
Well, actually, I’ll use a metric that’s almost the same (in particular being infinite in the same places) but easier to compute: with pointlike trees, what’s the longest rectangle of width \(d\) that one can fit anywhere in the lattice with long side at angle \(\theta\) from an axis?</p>

<p>Here’s a gif of the result.<sup id="fnref:b" role="doc-noteref"><a href="#fn:b" class="footnote">4</a></sup></p>

<p style="text-align:center;">
	<img src="/img/croprows/openness_plots.gif" width="60%" />
</p>

<p>There’s a lot of cool stuff to see in this!
Most obviously, you can see the lattice directions opening up in the predicted sequence: the cardinal directions (\((1,0)\) etc.) are open at the start, and then the \((1,1)\) direction and friends open up when \(d = \frac{1}{\sqrt{2}}\), and then the \((1,2)\) directions and friends open up, and so on.
Interestingly, a direction is always a local minimum just before it opens up – when \(d\) is just larger than \(w_{a,b}\), changing angle just a little bit in either direction will let you “see” one tree further.
This is a neat one to try to understand by playing with a diagram yourself.
There also seem to be no local maxima that aren’t vertical asymptotes.
These properties give the process a sort of fractally feel: concave-up regions between vertical asymptotes get recursively split in two by new asymptotes.</p>

<p>This is cool and all – it’s a parameterized function which gains vertical asymptotes corresponding to all the rational numbers as the parameter decreases! – but I still want a nice analytical version of this.
If you have any ideas, let me know!</p>

<p><br /></p>

<h4 id="code-and-acknowledgements">Code and acknowledgements</h4>

<p>You can find my code for generating these plots <a href="https://github.com/james-simon/lattice-math">here</a>.
Thanks to Vincent Huang for pointing me to Farey sequences.</p>

<hr />
<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:f" role="doc-endnote">
      <p>I’m actually quite impressed that these plants are spaced regularly enough over such a large area to give such regular patterns! <a href="#fnref:f" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:q" role="doc-endnote">
      <p>By this, we mean to disallow vectors like \((4, 6)\) and \((2, 0)\) where either (a) the elements are not coprime or (b) zero is paired with an integer not equal to one. <a href="#fnref:q" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:a" role="doc-endnote">
      <p>Noise in the placement of trees has essentially the same effect as nonzero tree width. <a href="#fnref:a" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:b" role="doc-endnote">
      <p>Note that I’m changing the size of the trees in this animation here even though it’s really the width of an imaginary rectangle that’s changing. <a href="#fnref:b" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>

  </div>

</article>

      </div>
    </div>

    <div class="text-center p-3" style="background-color: #edf3f5;">
  <div class="container ">
    <div class="row justify-content-md-center">

      <div class="col-2">
        <p class="text-center">
          <i class="far fa-envelope"></i>
          <a href="mailto:jsi@berkeley.edu">jsi@berkeley.edu</a>
        </p>
      </div>

      <div class="col-2">
        <p class="text-center">
          <i class="fab fa-github"></i>
          <a href="https://github.com/james-simon">james-simon</a>
        </p>
      </div>

      <div class="col-2">
        <p class="text-center">
          <i class="fas fa-graduation-cap"></i>
          <a href=https://scholar.google.com/citations?user=zjGfh3sAAAAJ&hl=en>gScholar</a>
        </p>
      </div>

      <div class="col-2">
        <p class="text-center">
          <i class="fab fa-instagram"></i>
          <a href="https://instagram.com/sam.simon17">sam.simon17</a>
        </p>
      </div>

      <div class="col-2">
        <p class="text-center">
          SSN: 314-15-9265
        </p>
      </div>

    </div>
  </div>
</div>
</footer>

  </body>

</html>
