---
layout: default
permalink: /tensorizer/
---

<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    chtml: {
      scale: 1.0  // Normal size
    },
    startup: {
      ready: () => {
        MathJax.startup.defaultReady();
        console.log('MathJax is ready');
        // Trigger initial formula rendering once MathJax is ready
        MathJax.startup.promise.then(() => {
          if (window.updateFormulaDisplay) {
            window.updateFormulaDisplay();
          }
        });
      }
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<link rel="stylesheet" href="styles.css">

<style>
  /* Wider container for tensorizer page at larger screen sizes */
  @media (min-width: 1350px) {
    .container {
      max-width: 1300px;
    }
  }

  @media (min-width: 1500px) {
    .container {
      max-width: 1450px;
    }
  }
</style>

<div class="container">
  <div style="position: relative;">
    <h1 style="margin-top: 2em;">Tensorizer</h1>
    <button id="helpButton" class="page-help-button" title="Help">mouse over for help</button>
  </div>

  <p style="font-size: 16px; margin-bottom: 1.5em;">
    This is an interactive tool for simulating gradient descent on deep linear networks and general tensor networks. Draw a model in the canvas on the left, set hyperparameters at the bottom, run the simulation with a random target tensor $\mathbf{T}_*$, and look at its training dynamics.
  </p>

  <div class="tensorizer-container">
    <div class="canvas-wrapper">
      <canvas id="tensorCanvas" width="800" height="600"></canvas>

      <!-- Floating toolbar in top-left -->
      <div class="floating-toolbar">
        <div class="tool-button active" id="mouseTool" title="Select/Move">
          <div class="tool-icon-mouse">➤</div>
        </div>
        <div class="tool-button" id="panTool" title="Pan Canvas">
          <div style="font-size: 40px; line-height: 1; margin-top: -3px;">☩</div>
        </div>
        <div class="tool-button" id="tensorTool" title="Create Tensor">
          <div class="tool-icon-box">A</div>
        </div>
        <div class="tool-button" id="connectionTool" title="Create Connection">
          <div class="tool-icon-line"></div>
        </div>
        <div class="tool-button" id="eraserTool" title="Eraser">
          <div class="tool-icon-eraser">✕</div>
        </div>
        <div class="tool-button" id="undoButton" title="Undo (Ctrl+Z)">
          <div style="font-size: 30px;">⎌</div>
        </div>
        <div class="tool-button" id="redoButton" title="Redo (Ctrl+Shift+Z)">
          <div style="font-size: 30px; transform: scaleX(-1);">⎌</div>
        </div>
      </div>

      <!-- Floating toggles in top-right -->
      <div class="floating-toggles">
        <label title="Show rank labels on tensor legs">
          <input type="checkbox" id="showRanksButton">
          show ranks
        </label>
        <label title="Show singular value visualizations on tensor legs">
          <input type="checkbox" id="showSVsButton">
          show sing. vals
        </label>
      </div>

      <!-- Floating formula display in bottom-left -->
      <div id="formulaDisplay" class="floating-formula">T = 1</div>

      <!-- Floating properties panel in bottom-right -->
      <div class="floating-properties" id="propertiesPanel" style="display: none;">
        <div id="tensorEditor" style="display: none;">
          <h3>Tensor Properties</h3>
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="margin: 0;">name:</label>
            <input type="text" id="tensorName" placeholder="" maxlength="1" style="width: 30px; text-align: center; transition: border-color 0.2s;">
          </div>
        </div>
        <div id="legEditor" style="display: none;">
          <h3>Leg Properties</h3>
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="margin: 0;">name:</label>
            <input type="text" id="legName" placeholder="" maxlength="1" style="width: 30px; text-align: center; transition: border-color 0.2s;">
          </div>
        </div>
      </div>

      <!-- Pop sounds -->
      <audio id="pop-1" preload="auto" src="{{site.baseurl}}/audio/pop_1.mp3"></audio>
      <audio id="pop-2" preload="auto" src="{{site.baseurl}}/audio/pop_2.mp3"></audio>
      <audio id="pop-3" preload="auto" src="{{site.baseurl}}/audio/pop_3.mp3"></audio>
      <audio id="pop-4" preload="auto" src="{{site.baseurl}}/audio/pop_4.mp3"></audio>
    </div>

    <div class="controls-panel">
      <div id="sidePanelLossPlot">
        <div style="border: 1px solid #ccc; border-radius: 4px; background: white; padding: 10px; box-sizing: border-box; height: 285px;">
          <h4 style="margin: 0 0 10px 0; text-align: center;">loss</h4>
          <div style="height: calc(100% - 30px); position: relative;">
            <canvas id="sidePanelLossCanvas"></canvas>
            <div id="lossYAxisLabel" style="position: absolute; left: -45px; top: 33%; transform: rotate(-90deg) translateY(-50%); transform-origin: center center; font-size: 17.5px; white-space: nowrap;">$\mathcal{L} = |\!| \mathbf{T} - \mathbf{T}_* |\!|_F^2$</div>
          </div>
        </div>
      </div>

      <div id="sidePanelSVPlot" style="margin-top: 10px; display: none;">
        <div style="border: 1px solid #ccc; border-radius: 4px; background: white; padding: 10px; box-sizing: border-box; height: 285px;">
          <h4 style="margin: 0 0 10px 0; text-align: center;" id="sidePanelSVPlotTitle">Singular Values</h4>
          <div style="height: calc(100% - 30px);">
            <canvas id="sidePanelSVCanvas"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="simulation-controls">
    <button id="startPauseButton" class="sim-button">start</button>
    <button id="resetButton" class="sim-button">reset</button>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label for="learningRate">learning rate:</label>
      <input type="range" id="learningRate" min="0" max="100" value="50" style="width: 150px;">
      <span id="learningRateValue">0.01</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label for="globalInitScale">init scale:</label>
      <input type="range" id="globalInitScale" min="0" max="100" step="1" value="50" style="width: 100px;">
      <span id="globalInitScaleValue">1</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label for="globalDimension">leg dimension:</label>
      <input type="range" id="globalDimension" min="0" max="100" step="1" value="35" style="width: 100px;">
      <span id="globalDimensionValue">5</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label>current loss:</label>
      <span id="currentLoss" style="font-weight: bold;">—</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label>steps/sec:</label>
      <span id="stepsPerSec" style="font-weight: bold;">—</span>
    </div>
    <div style="display: flex; align-items: center; gap: 10px; margin-left: 20px;">
      <label title="Use manual random seeds for initialization and target tensor">
        <input type="checkbox" id="manualSeedsCheckbox">
        manual random seeds
      </label>
    </div>
    <div id="seedInputs" style="display: none; align-items: center; gap: 10px; margin-left: 20px;">
      <label for="initSeed">init seed:</label>
      <input type="number" id="initSeed" step="1" min="0" value="0" style="width: 80px;">
      <label for="targetSeed">$\mathbf{T}_*$ seed:</label>
      <input type="number" id="targetSeed" step="1" min="0" value="0" style="width: 80px;">
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
<script src="geometry.js"></script>
<script src="sliders.js"></script>
<script src="charts.js"></script>
<script src="utils.js"></script>
<script src="state.js"></script>
<script src="drawing.js"></script>
<script src="formula.js"></script>
<script src="input.js"></script>
<script src="ui.js"></script>
<script src="simulation.js"></script>
<script src="help.js"></script>
<script src="tensorizer.js"></script>
