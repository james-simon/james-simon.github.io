---
layout: default
permalink: /expander-nets/
skip_mathjax: true
---

<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']]
    },
    chtml: {
      scale: 1.0
    },
    startup: {
      ready: () => {
        MathJax.startup.defaultReady();
        console.log('MathJax is ready');
        // Set flag that MathJax is ready
        window.mathJaxReady = true;
      }
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<link rel="stylesheet" href="styles.css">

<div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h1 class="page-title">Expander Nets</h1>
    <button id="resetToDefaultsButton" class="sim-button">reset to defaults</button>
  </div>

  <hr style="border: none; border-top: 2px solid #ccc; margin-top: 1em; margin-bottom: 0.2em;">

  <div class="section-label">SETUP</div>

  <div style="margin-top: 0; margin-bottom: 2em;">
    <!-- Row 1: Network (Red) with diagram on the right -->
    <div style="display: flex; gap: 1em; margin-bottom: 1em;">
      <div style="background-color: #fff0f0; padding: 1.5em; padding-top: 3em; padding-bottom: 3em; border-radius: 8px; position: relative; min-height: 120px; flex: 1;">
        <div style="position: absolute; left: 20px; top: 50%; transform: rotate(-90deg) translateX(-50%); transform-origin: left center; font-size: 14px; font-weight: 600; color: #cc5555; white-space: pre;">    NETWORK</div>
        <div style="display: flex; gap: 2em; margin-left: 60px;">
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 15px; margin-bottom: 4px; color: #666;">network function</div>
            <div>$$\hat{f}(\mathbf{x}) = \mathbf{W}_2 \, \sigma \circ \mathbf{W}_{\mathrm{froz}} \, \mathbf{W}_1 \, \mathbf{x}$$</div>
            <div style="font-size: 13px; margin-top: 8px; color: #888;">$$\mathbf{W}_2 \in \mathbb{R}^{1 \times k}, \, \mathbf{W}_{\mathrm{froz}} \in \mathbb{R}^{k \times d},$$</div>
            <div style="font-size: 13px; margin-top: 4px; color: #888;">$$\mathbf{W}_1 \in \mathbb{R}^{d \times d}, \, \mathbf{x} \in \mathbb{R}^d$$</div>
          </div>
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 15px; margin-bottom: 4px; color: #666;">nonlinearity</div>
            <div>$$\sigma(z) = \sqrt{2} \cos\left(z + \frac{\pi}{4}\right)$$</div>
          </div>
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 15px; margin-bottom: 4px; color: #666;">hidden dimension</div>
            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 6px; flex-wrap: nowrap;">
              <span style="font-size: 17px; white-space: nowrap;">$k$:</span>
              <input type="range" id="kSlider" min="0" max="100" value="50" style="width: 120px; flex-shrink: 1;">
              <span id="kValue" style="font-size: 15px; text-align: left; white-space: nowrap;">1000</span>
            </div>
          </div>
        </div>
      </div>
      <div style="display: flex; justify-content: center; align-items: center; flex-shrink: 0;">
        <svg id="networkViz" width="400"></svg>
      </div>
    </div>

    <!-- Row 2: Data (Orange) -->
    <div style="background-color: #fff8f0; padding: 1.5em; padding-top: 3em; padding-bottom: 3em; border-radius: 8px; margin-bottom: 1em; position: relative; min-height: 120px;">
      <div style="position: absolute; left: 20px; top: 50%; transform: rotate(-90deg) translateX(-50%); transform-origin: left center; font-size: 14px; font-weight: 600; color: #cc8855; white-space: pre;">    DATA</div>
      <div style="display: flex; gap: 2em; margin-left: 60px;">
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">data distro</div>
          <div>$$\mathbf{x} \sim \mathcal{N}(0, \mathbf{\Gamma})$$</div>
        </div>
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">data dimension</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 6px;">
            <span style="font-size: 18px;">$d$:</span>
            <input type="range" id="dSlider" min="1" max="5" value="3" style="width: 120px;">
            <span id="dValue" style="font-size: 16px; min-width: 30px; text-align: left;">3</span>
          </div>
        </div>
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">data covariance</div>
          <div style="margin-bottom: 8px;">$$\mathbf{\Gamma} = \mathrm{diag}(\gamma_i)$$</div>
          <div id="gammaSliders" style="display: flex; flex-direction: column; gap: 6px; align-items: center;"></div>
        </div>
      </div>
    </div>

    <!-- Row 3: Target (Green) -->
    <div style="background-color: #f0fff0; padding: 1.5em; padding-top: 3em; padding-bottom: 3em; border-radius: 8px; margin-bottom: 1em; position: relative; min-height: 140px;">
      <div style="position: absolute; left: 20px; top: 50%; transform: rotate(-90deg) translateX(-50%); transform-origin: left center; font-size: 14px; font-weight: 600; color: #55aa55; white-space: pre;">    TARGET    FUNCTION</div>
      <div style="display: flex; gap: 2em; margin-left: 60px; flex-wrap: wrap;">
        <div style="text-align: center; flex: 1; min-width: 300px;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">target function</div>
          <div id="targetFunctionEquation">$$\begin{align}
f_*(\mathbf{x}) &= h_{\boldsymbol{\alpha}}\left(\mathbf{\Gamma}^{-1/2} \mathbf{x}\right) \\
&= h_1(\gamma_1^{-1/2} x_1) \cdot h_2(\gamma_2^{-1/2} x_2) \cdot h_3(\gamma_3^{-1/2} x_3)
\end{align}$$</div>
        </div>
        <div style="text-align: center; flex: 0 0 auto;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">number of terms</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px;">
            <input type="range" id="numTermsSlider" min="1" max="3" value="1" style="width: 100px;">
            <span id="numTermsValue" style="font-size: 16px; min-width: 20px; text-align: left;">1</span>
          </div>
        </div>
        <div id="alphaColumns" style="display: flex; gap: 2em; flex: 1; min-width: 200px;"></div>
      </div>
    </div>

    <!-- Row 4: Training (Blue) -->
    <div style="background-color: #f0f4ff; padding: 1.5em; padding-top: 3em; padding-bottom: 3em; border-radius: 8px; margin-bottom: 1em; position: relative; min-height: 120px;">
      <div style="position: absolute; left: 20px; top: 50%; transform: rotate(-90deg) translateX(-50%); transform-origin: left center; font-size: 14px; font-weight: 600; color: #5578cc; white-space: pre;">    TRAINING</div>
      <div style="display: flex; gap: 2em; margin-left: 60px;">
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">loss</div>
          <div>$$\mathcal{L} = \frac{1}{2} \mathbb{E}_\mathbf{x}\left[(f_*(\mathbf{x}) - \hat{f}(\mathbf{x}))^2\right]$$</div>
        </div>
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">initialization</div>
          <div>$$\begin{align}
\mathbf{W}_1(0) &= \mathbf{I}_d \\
\mathbf{W}_{\mathrm{froz},ij} &\sim \mathcal{N}(0, 1) \\
\mathbf{W}_2(0) &= \mathbf{0}
\end{align}$$</div>
        </div>
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">dynamics</div>
          <div>$$\begin{align}
\dot{\mathbf{W}}_1 &= -\nabla_{\mathbf{W}_1} \mathcal{L} \\
\dot{\mathbf{W}}_{\mathrm{froz}} &= \mathbf{0} \\
\dot{\mathbf{W}}_2 &= -\frac{1}{k}\nabla_{\mathbf{W}_2} \mathcal{L}
\end{align}$$</div>
        </div>
      </div>
    </div>

    <!-- Row 5: Hyperparameters (Purple) -->
    <div style="background-color: #f8f0ff; padding: 1.5em; padding-top: 3em; padding-bottom: calc(3em + 30px); border-radius: 8px; margin-bottom: 1em; position: relative; min-height: 120px;">
      <div style="position: absolute; left: 20px; top: 50%; transform: rotate(-90deg) translateX(-50%); transform-origin: left center; font-size: 14px; font-weight: 600; color: #9955cc; white-space: pre;">    HYPERPARAMETERS</div>
      <div style="display: flex; gap: 2em; margin-left: 60px;">
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">learning rate</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 6px;">
            <span style="font-size: 18px;">$\eta$:</span>
            <input type="range" id="etaSlider" min="0" max="100" value="50" style="width: 120px;">
            <span id="etaValue" style="font-size: 16px; min-width: 60px; text-align: left;">0.01</span>
          </div>
        </div>
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 16px; margin-bottom: 4px; color: #666;">batch size</div>
          <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 6px;">
            <span style="font-size: 18px;">$|B|$:</span>
            <input type="range" id="batchSizeSlider" min="0" max="100" value="50" style="width: 120px;">
            <span id="batchSizeValue" style="font-size: 16px; min-width: 60px; text-align: left;">100</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <hr style="border: none; border-top: 2px solid #ccc; margin-top: 2em; margin-bottom: 0.2em;">

  <div class="section-label">SIMULATION</div>

  <div style="margin-top: 1em; margin-bottom: 2em;">
    <div style="display: flex; gap: 1em; align-items: center; margin-bottom: 2em;">
      <button id="startPauseButton" class="sim-button">start</button>
      <button id="resetButton" class="sim-button">reset</button>
    </div>

    <!-- Plots -->
    <div class="plots-container">
      <div class="plot-wrapper">
        <div class="plot-box">
          <div class="plot-content">
            <canvas id="lossChart" class="plot-canvas"></canvas>
            <div class="y-axis-label y-axis-label-loss">loss $\mathcal{L}$</div>
            <div class="x-axis-label">step</div>
          </div>
        </div>
      </div>
      <div class="plot-wrapper">
        <div class="plot-box">
          <div class="plot-content">
            <canvas id="normChart" class="plot-canvas"></canvas>
            <div class="y-axis-label y-axis-label-norms" id="paramSizeLabel">parameter size</div>
            <div class="x-axis-label">step</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Plot controls -->
    <div class="logscale-control">
      <label style="margin-right: 20px;">
        <input type="checkbox" id="logScaleXCheckbox">
        logscale x-axes
      </label>
      <label style="margin-right: 20px;">
        <input type="checkbox" id="logScaleCheckbox">
        logscale y-axes
      </label>
      <label style="margin-right: 20px;">
        <input type="checkbox" id="showTheoryCheckbox">
        show theory curves
      </label>
      <span style="margin-right: 0.5em;">plot w.r.t.</span>
      <span class="plot-xaxis-toggle">
        <a href="#" id="step-link" class="active" onclick="setXAxisMode('step'); return false;">step</a><a href="#" id="teff-link" onclick="setXAxisMode('teff'); return false;">$t_{\mathrm{eff}}$</a>
      </span>
      <span style="margin-left: 30px; display: inline-flex; align-items: center; gap: 8px;">
        <span>EMA:</span>
        <input type="range" id="emaSlider" min="0" max="100" value="0" style="width: 120px;">
        <span id="emaValue" style="min-width: 30px; text-align: left;">0</span>
      </span>
    </div>

    <!-- Steps per second display -->
    <div style="margin-top: 1.5em; text-align: center; color: #666; font-size: 14px;">
      <label>steps/sec:</label>
      <span id="stepsPerSec" style="font-weight: bold;">—</span>
    </div>

    <!-- Theory section -->
    <hr class="theory-separator">

    <div class="theory-section-label">THEORY COMPUTED BELOW THIS LINE</div>

    <div class="theory-row">
      <div class="theory-modeling-ode">
        <div class="theory-modeling-ode-label">modeling ODE</div>
        <div class="theory-modeling-ode-formula" id="modelingOdeFormula">
          $\mathcal{L} = \frac{1}{2}\left(1 - c a_1^{\alpha_1} \cdots a_d^{\alpha_d} b\right)^2$
        </div>
      </div>

      <div class="theory-modeling-ode">
        <div class="theory-modeling-ode-label">dynamics</div>
        <div class="theory-modeling-ode-formula" id="dynamicsFormula">
          $\begin{align}
          \dot{a}_i &= -\partial_{a_i} \mathcal{L} \\
          \dot{b} &= -\partial_b \mathcal{L}
          \end{align}$
        </div>
      </div>

      <div class="theory-modeling-ode">
        <div class="theory-modeling-ode-label">initialization</div>
        <div class="theory-modeling-ode-formula" id="initializationFormula">
          $\begin{align}
          a_i(0) &= 1 \\
          b(0) &= 0
          \end{align}$
        </div>
      </div>

      <!-- Rate constant columns (1-3 depending on numTerms) -->
      <div id="rateConstantColumns" style="display: flex; gap: 2em; flex-wrap: wrap;"></div>
    </div>

    <hr class="theory-row-separator" id="theoryRowSeparator">

    <div class="theory-metrics" id="theoryMetricsRow2">
      <div class="theory-metric">
        <div class="theory-metric-label">number of relevant directions</div>
        <div class="theory-metric-formula">$d_{\mathrm{rel}} = \#\{\alpha_i > 0\}$</div>
        <div class="theory-metric-value" id="relevantDirectionsValue">—</div>
      </div>

      <div class="theory-metric">
        <div class="theory-metric-label">order of $f_*$</div>
        <div class="theory-metric-formula">$|\boldsymbol{\alpha}| = \sum_i \alpha_i$</div>
        <div class="theory-metric-value" id="orderOfFStarValue">—</div>
      </div>

      <div class="theory-metric">
        <div class="theory-metric-label">order of dynamical system</div>
        <div class="theory-metric-formula">$\ell = |\boldsymbol{\alpha}| + 1$</div>
        <div class="theory-metric-value" id="totalOrderValue">—</div>
      </div>

    </div>

    <hr class="theory-row-separator" id="theoryRowSeparator2">

    <div class="theory-metrics" id="theoryMetricsRow3">
      <div class="theory-metric">
        <div class="theory-metric-label">mean core parameter at init</div>
        <div class="theory-metric-formula">
          $\beta = \frac{1}{d+1} \left(\sum_i \frac{|a_i(0)|}{\sqrt{\alpha_i}} + |b(0)|\right)$
        </div>
        <div class="theory-metric-value" id="betaValue">—</div>
      </div>

      <div class="theory-metric">
        <div class="theory-metric-label">shape parameters</div>
        <div class="theory-metric-formula">
          $r_i = \frac{a_i(0)^2}{\alpha_i \beta^2}$
        </div>
        <div class="theory-metric-value" id="shapeParamsValue">—</div>
      </div>

      <div class="theory-metric">
        <div class="theory-metric-label">shape integral</div>
        <div class="theory-metric-formula">
          $F(\mathbf{r}) = \left(\frac{\ell}{2} - 1\right) \int_0^\infty (s + r_b)^{-1/2} \prod_i (s + r_i)^{-\alpha_i/2} \, ds$
        </div>
        <div class="theory-metric-value" id="shapeIntegralValue">—</div>
      </div>
    </div>

    <div class="theory-rise-time" id="theoryRiseTime">
      <div class="theory-rise-time-label">rise time</div>
      <div class="theory-rise-time-formula">
        $t_{\mathrm{rise}} = \begin{cases}
          c^{-2} & \text{if } \ell = 1, \\
          -\frac{1}{c} \cdot \log(c\beta) & \text{if } \ell = 2, \\
          \frac{1}{\ell - 2} \cdot \frac{1}{c} \cdot \frac{F(\mathbf{r})}{\beta^{\ell-2}} & \text{if } \ell > 2.
        \end{cases}$
      </div>
      <div class="theory-rise-time-value" id="triseValue">—</div>
    </div>
  </div>

</div>

<!-- Dependencies -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>

<!-- Application (ES6 module) -->
<script type="module" src="app.js"></script>
